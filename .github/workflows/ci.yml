name: CI Pipeline

on:
  pull_request:
    branches: [main, master]

  push:
    branches: [main, master]

jobs:
  run-tests:
    name: Run Unit Tests
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.12'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
          pip install pytest  # если pytest нет в requirements
      
      - name: Run unit tests
        run: |
          # поиск тестов в проекте
          if [ -d "tests" ]; then
            python -m pytest tests/ -v
          elif [ -f "setup.py" ]; then
            python -m pytest -v
          else
            echo "No tests found. Running simple test check..."
            python -c "print('Tests passed (no tests to run)')"
          fi
  
  run-ruff:
    name: Run Ruff Linter
    runs-on: ubuntu-latest
    needs: run-tests  # Этот job ждёт завершения тестов
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Run Ruff
        uses: astral-sh/ruff-action@v1
        with:
          # Проверка стиля и ошибок
          args: "check --output-format=github"
         
      
      #  проверка форматирования
      - name: Check formatting with Ruff
        run: |
          python -m pip install ruff
          ruff format --check .
